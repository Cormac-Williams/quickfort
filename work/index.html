<html>
<head>
<title>Quickfort</title>
</head>
<body style="font-family: Segoe UI,Trebuchet MS,sans-serif">
<h1>Quickfort 1.02</h1>
A construction tool for Dwarf Fortress
<BR><BR>
<B>
	<img src="minihammer.gif">&nbsp;<a href="Quickfort_1.02.zip">Download latest version of Quickfort here</a>
	<BR><BR>
	<img src="x.gif" width=16 height=16>&nbsp;<a href="http://www.bay12games.com/forum/index.php?topic=35931.0">Bay12 forum thread</a>
</B>
<BR><BR>
<HR>
<pre>Quickfort 1.02
By joelpt &lt;<a href="mailto:quickfort@joelpt.net">quickfort@joelpt.net</a>&gt;

Quickfort is an AutoHotkey-based utility for Dwarf Fortress that helps you build
fortresses from "blueprint" .CSV files (comma separated values). These files are
easily created and edited in an app like Excel. Most building-oriented DF
commands are supported through the use of multiple .CSV files to describe the
different phases of DF construction (designation, building, stockpiles, and
making adjustments).

Original idea and initial codebase from <a href="http://www.bay12games.com/forum/index.php?topic=1428.0">Valdemar's designator.ahk script</a>.

With Quickfort, you can turn .CSV files like these

<img src="http://imgur.com/8tpp6.png" alt="" class="bbc_img" /> <img src="http://imgur.com/ohxc7.png" alt="" class="bbc_img" /> <img src="http://imgur.com/5obn9.png" alt="" class="bbc_img" />

into something like this.

<img src="http://imgur.com/437t2.png" alt="" class="bbc_img" />



FEATURES
========

* Design complete blueprints in .CSV files to handle 4 main phases of construction
* Ability to leave author's comments in blueprints (shown to blueprint user)
* Multi-Z-level blueprints
* Repeating construction mode in any direction including up/down
* Simple command line entry
* Aliases
* Keystroke (construction speed) optimizations
* Minimalist (and optional) GUI
* Assortment of sample blueprints included


BASIC USAGE
===========

Quickfort's GUI consists of a mouse tooltip, hotkeys and a few popup windows.
Quickfort does not need AutoHotkey installed.

Start Dwarf Fortress (windowed mode recommended). Run Quickfort.exe. 

Use Alt+D to select a CSV file to execute. There are some samples in the
Examples folder. Quickfort will give instructions in the mouse tooltip for
positioning the in-game cursor. Once positioned, use Alt+D again to begin.
Quickfort will send the keystrokes necessary to DF to dig, build, place, or
query according to the chosen blueprint. Resist the urge to touch the mouse or
keyboard at this time.

Alt+Q/W/A/S can be used to change the starting corner for the blueprint (that
is, which corner of the blueprint you'll put the starting cursor at). The
current starting corner setting will be shown in the QF tooltip. These hotkeys
have no effect if the blueprint specifies a starting cursor position; see
the "Specifying a starting position" section below for more details.

Alt+R can be used to repeat a blueprint any number of times to the north, south,
east, west, up, and down. This can be useful for digging multilevel
staircases/shafts, repeating room complexes, etc.

Alt+T opens the Quickfort command line. Here you can enter a single-line
QF-style command. Commands entered this way can be repeated with Alt+R as well.

Hold down Alt+C to cancel Quickfort's build routine partway through.

After a build completes, Alt+E can be used to redo the same blueprint again, or
use Alt+D again to select a new blueprint. Alt+H can be used to hide QF's
mouse tooltip when not building; all hotkeys will continue to work.

Shift+Alt+Z suspends/resumes Quickfort, useful if you find it to interfere with
other windows. Shift+Alt+X exits Quickfort.


EDITING CSV FILES
=================

The format of Quickfort-compatible .CSV files is straightforward. The format has
changed slightly from Valdemar's designator.ahk format, but should only require
minor editing/search-and-replacing to work with Quickfort.

Use Excel or Google Docs to edit these files if at all possible (be sure to save
as CSV file). The first line of the file should look like this:
  
#dig This is a comment.

The keyword "dig" tells Quickfort we are going to be using the Designations menu
in DF. The following keywords are understood:
  
  dig     Designations menu (d)
  build   Build menu (b)
  place   Place stockpiles menu (p)
  query   Set building tasks/prefs menu (q)
  
Optionally following this keyword and a space, you may enter a comment. This
comment will appear by default after loading the CSV file with Quickfort
(Alt+D). You can use this space for explanations, attribution, etc. Newlines may
be entered by using \n.

Below this line begin entering the keys you want sent in each cell (it's assumed
you are using a spreadsheet editor here). For example, we could dig out a 3x5
room with an up/down staircase in the corner like so (spaces are used as column
separators here):
  
#dig
i d d d #
d d d d #
d d d d #
d d d d #
d d d d #
# # # # #

Note the # symbols at the right end of each row and below the last row. These
are OPTIONAL, but can be helpful. If you omit them QF *should* render your
blueprint properly. If you run into problems (e.g. Excel saving 'blank' cells
and rows unnecessarily), use # symbols as shown above to clearly delineate the
area. These tell QF where the edges of your blueprint are.

Once the dwarves have that dug out, let's build a walled in bedroom within our
dug-out area:
  
#build
Cw Cw Cw Cw #
Cw b  h  Cw #
Cw       Cw #
Cw Cw d  Cw #
#  #  #  #  #

Note my generosity - I've placed a bed, chest and door here as well. Note that
you must use the full series of keys needed to build something in each cell,
e.g. Cw for each wall segment.

I'd also like to place a booze stockpile in the 2 unoccupied tiles in the room.

#place Place a food stockpile
` ` ` ` #
` ` ` ` #
` f(2x1)#
` ` ` ` #
# # # # #
        
This illustration may be a little hard to understand. The f(2x1) is in column 2,
row 3. All the other cells are empty. QF considers both ` and ~ characters
within cells to be empty cells; this can help with multilayer or fortresswide
blueprint layouts.

With f(2x1), we've asked QF to place a Food stockpile 2 units wide by 1 high
unit, or f(2x1). QF sends the necessary keys to resize the placement region.
This also works properly in all modes, including build mode (floors Cf(10x10),
bridges ga(4x4), etc. that are sized with UMKH keys).

Lastly, let's turn the bed into a bedroom, and set the food stockpile to hold
only booze.

#query
` ` ` ` #
` r+` ` #
` booze #
# # # # #

In column 2, row 3 we have r+. This sends r+ keys to DF when the cursor is over
the bed, causing us to 'make room' and increase its size slightly just in case.

In column 2, row 4 is just "booze". booze is an alias keyword defined in the
included aliases.txt file. This particular alias sets a food stockpile to carry
booze only, by sending the keystrokes needed to navigate DF's stockpile settings
menu.

The Examples/General/bedroom-*.csv files provide a good simple example of a
4-layer QF blueprint. Check out aliases.txt for some helpful starting aliases.
Examples/Bukgeshud provides a detailed set of examples.


SPECIFYING A STARTING POSITION
==============================

You can optionally specify a cursor starting position for a particular 
blueprint, simplifying the task of blueprint alignment. This can be helpful
for blueprints that are based on a central staircase, for example.

To specify a cursor starting position, use the following modified format 
for the header line of your CSV file:
  
  #mode start(X;Y;STARTCOMMENT) comment

where X and Y specify the starting cursor position (1;1 is the top left cell)
and STARTCOMMENT (optional) is a description displayed to the QF user of
where to position their cursor. This description appears in the pre-playback
mouse tooltip.

A couple examples:

  #dig start(3; 3; Center tile of a 5-tile square) Regular blueprint comment
  #build start(10;15)

When a start() parameter is found in a CSV file, the normal Alt+Q/W/A/S
starting corner setting has no effect.

See Examples/Tests/starting-position.csv for a simple example. 
The Examples/Buketgeshud/*.csv examples all utilize start().


MULTILEVEL BLUEPRINTS
=====================

Multilevel blueprints are accommodated by separating Z-levels of the blueprint
with #> or #< at the end of each floor:

#dig Stairs leading down to a small room below
j ` #
` ` #
#># #
u d #
d d #
# # #


LAYERING BLUEPRINTS
===================

A complete QF specification for a floor of your fortress may contain 4 or more
separate CSV blueprints, one for each "phase" of construction (dig/designate,
build, place stockpiles, building adjustments). These phases suggest a
convenient naming scheme for blueprints, as seen in the Examples/General folder:
  
  bedroom-dig.csv
  bedroom-build.csv
  bedroom-stockpile.csv
  bedroom-adjust.csv
  
The naming scheme is up to you, of course. A similar approach is used in the
Examples/Buketgeshud folder.

After digging out an area, it's often helpful to dump all leftover stone in the
area before beginning the build phase. You may also wish to smooth/engrave the
area before filling it in.


TROUBLESHOOTING
===============

* Always check QF's mousetip instructions before hitting Alt+D to begin a
  blueprint. Being in the wrong menu is a common cause of wacky behavior.

* If you have trouble just getting one of the sample files to work, take a look
  at options.txt. Slowing down QF's key sending delay or other adjustments can
  help with problems.

* QF has no way of detecting when you run out of building materials during build
  mode; it just blithely assumes that the first material that appears in DF's
  materials list while building will be sufficient. For constructions that take
  many materials such as a big retracting bridge gs(10x10), if sending
  Shift+Enter does not provide all the materials required to build, the script
  will go off the rails. Some micromanagement of stockpile location or 
  temporarily forbidding unwanted materials can help here.

* If the script goes off the rails for some reason, use Alt+C to cancel it. If
  you've built a bunch of beds but ran out before the script finished, for
  example, you can use the Alt+X key while in DF's q menu. This causes QF to
  send x 30 times to DF - an easy way to remove a large region of buildings
  quickly.

* If you cancel playback, DF may become unresponsive to your input. Tapping
  the ALT key usually fixes this.
  
* Workshops, depots, stores, furnaces, and others place from their CENTER tile,
  rather than their top left tile as specified in the CSV. Make sure to account
  for these offsets in your blueprint. When in doubt, try positioning the cursor
  in game, then switch to the object you want to place and observe which of its
  tiles it anchors from.

* Objects such as screw pumps and towers take special consideration in QF-based
  construction. See the screw pump tower examples. For placing large areas of
  flooring for towers, consider using instructions like Cf(10x10). QF doesn't
  account for what needs to be built in what order, it just proceeds across then
  down (A Z pattern). Setting up multiple CSV layers to dig/build in phases may
  help.

* Avoid running QF near the edges of the map, or set
  DisableBacktrackingOptimization=1 in options.txt.


CREATE AN EXCEL MACRO TO SIZE ALL COLUMNS TO A UNIFORM NARROW WIDTH
===================================================================

This tip can help when working with a lot of CSV files.

 1. In Excel, go to Tools->Macro->Record New Macro
 2. For macro name, enter NarrowColumns
 3. For shortcut key enter Ctrl+T (or your preference)
 4. Make sure it is set to store macro in Personal Macro Workbook.
 5. Hit OK.
 6. Click the gray corner cell in the very top left of the spreadsheet, between
    the row headers and the column headers. This should highlight the whole
    spreadsheet.
 7. Right click on column header A and select Choose Column Width.
 8. Type 2 and hit Enter.
 9. Go to Tools->Macro->Stop Recording.
10. Exit and restart Excel (this allows you to save your new macro).

Now, hit Ctrl+T in Excel at any time to size all columns of the current sheet to
a 2 unit width.

Other Excel tips:

* To repeat a block of cells either across or down, highlight the cells, then
  drag the small square handle on the lower right corner of your
  selection box. Do this across then down to repeat over a large area.
  This often works better than copy and paste.
  
* You can determine the size of a selected region in Excel by selecting the
  cells with the mouse or shift+arrow keys, then before releasing the mouse
  button or shift key, look at the top left area just above column A's header.
  Note that the way Excel reports the numbers are the OPPOSITE of how they
  are used in QF. For example, if Excel reports 9R x 4C, you would want to
  enter something like f(4x9) in your file.


TODO/FUTURE IDEAS 
=================

* Refactor codebase
* Support multidimensional repeating with Alt+R
* Support 'repeat' keyword in QF command line
* Support multiline entries in QF command line
* Test/support every placeable DF object/command
* Support top/repeatable middle/bottom multilevel blueprints
* Support manual and automatic build material selection, similar to DFWall
* Rowwise large construction analysis (d,d\nd,d\n -> d(2x2))
* Consider support for all build phases in one CSV (d;b;;r+)
* Consider CSV 'stacks' - meta-blueprints acting as indexes to other CSVs
* Consider GUI for blueprint creation (incorporation of all mode-layers in an
  Excel-like GUI)


CHANGELOG 
=========

1.02 (2009 June 3)
* Start position can now be specified in CSV file. See readme.txt for further
  details. Examples/Buketgeshud updated. (Xinael)
* Quickfort's tooltip now stays up all the time, but you can optionally hide it
  when not in placement or playback modes with the Alt+H hotkey (Xinael)
* The 'macro completed' popup has been removed in favor of the permanent tooltip
* Leading or trailing spaces within cells should no longer cause problems (LegoLord)
* Possible fix for flickering tooltip problem (Xinael)
* Possible speed improvement for 40d11/Mayday users (Xinael, Jhoosier)
* Z-level up/down default keybindings changed to Shift+5/Ctrl+5 for better
  compatibility (Jhoosier)
* Quickfort now emits a sound on playback completion (mutable in options.txt)

1.01 (2009 May 30)
* New options in options.txt to improve compatibility with different DF versions
  and key bindings (Xinael, Jhoosier)
* Auto cancel QF run if user switches away from DF window (Snuffy)

1.0 
* Initial release
</pre>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-4298456-1");
pageTracker._trackPageview();
} catch(err) {}</script>
</body>
</html>
